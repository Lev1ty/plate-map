var plateLayOutWidget = plateLayOutWidget || {};

(function($, fabric) {

  plateLayOutWidget.checkBox = function() {
    // For those check boxes associated with every field in the tab
    return {

      checkBoxes: [], 
      globalSelectedAttributes: [],

      _addCheckBox: function(fieldArray, fieldArrayIndex, data) {

        var checkImage = $("<img>").attr("src", this.imgSrc + "/dont.png").addClass("plate-setup-tab-check-box")
          .data("clicked", false).data("linkedFieldId", data.id);
        $(fieldArray[fieldArrayIndex - 1]).find(".plate-setup-tab-field-left-side").html(checkImage);
        this._applyCheckboxHandler(checkImage); // Adding handler for change the image when clicked
        fieldArray[fieldArrayIndex - 1].checkbox = checkImage;
        this.checkBoxes.push(checkImage); 
        return checkImage;
      },

      _applyCheckboxHandler: function(checkBoxImage) {
        // We add checkbox handler here, thing is it s not checkbox , its an image and we change
        // source
        var that = this;
        $(checkBoxImage).click(function(evt, machineClick) {
          var checkBox = $(this); 

          if (checkBox.data("clicked")) {
            checkBox.attr("src", that.imgSrc + "/dont.png");
          } else {
            checkBox.attr("src", that.imgSrc + "/do.png");
          }

          checkBox.data("clicked", !checkBox.data("clicked"));
          // when we un/select values it should reflect to the tiles selected at the moment
          that.globalSelectedAttributes = []; 
          for (var i = 0; i < that.checkBoxes.length; i++) {
            var cb = that.checkBoxes[i]; 
            if (cb.data("clicked")) {
              that.globalSelectedAttributes.push(cb.data("linkedFieldId")); 
            }
          }
          that._colorMixer(false); 
          // update values in allselectedObject
          // incase user changes some selection after selecting some preset. It clears preset
          // machineClick says if the click is generated by machine or user
          if (that.previousPreset && !machineClick) {
            $(that.previouslyClickedPreset).trigger("click", true);
          }

        });
      },
    };
  }
})(jQuery, fabric);