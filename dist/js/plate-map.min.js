"use strict";var plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.addDataOnChange=function(){return{_addAllData:function(t){var i=[];if(this.selectedIndices){var a=this.selectedIndices.length;this.selectedIndices.forEach(function(i){var n;i in this.engine.derivative?n=this.engine.derivative[i]:(n=e.extend(!0,{},this.defaultWell),this.engine.derivative[i]=n),n=this.processWellData(t,n,a),this.engine.wellEmpty(n)&&(this.disableAddDeleteWell?this.engine.derivative.hasOwnProperty(i)&&(n=e.extend(!0,{},this.emptyWellWithDefaultVal),this.engine.derivative[i]=n):delete this.engine.derivative[i])},this)}this._getAllMultipleVal(i),this.applyFieldWarning(i),this._colorMixer(),this.derivativeChange(),this.addToUndoRedo()},processWellData:function(e,t,i){for(var a in e)if(e.hasOwnProperty(a)){var n=e[a];if(null!=n){if(n.multi){var l=t[a];n=this._getMultiData(l,n,a,i)}n=JSON.parse(JSON.stringify(n))}else n=null;t[a]=n}return t},_getMultiData:function(e,t,i,a){var n=t.added,l=t.removed;if(n)if(e)if(n.value){var s=!0;for(var r in e){if(e.hasOwnProperty(r))e[r][i].toString()===n.id.toString()&&(s=!1,e=e.map(function(e){if(e[i].toString()===n.id.toString())for(var t in e)e.hasOwnProperty(t)&&t in n.value&&t!==i&&(1===a?e[t]=n.value[t]:n.value[t]&&(e[t]=n.value[t]));return e}))}s&&e.push(n.value)}else e.indexOf(n)<0&&e.push(n);else e=[],n.value?e.push(n.value):n&&e.push(n);var o,d=function(e,t){var i=[];for(var a in e)e.hasOwnProperty(a)&&parseInt(a)!==parseInt(t)&&i.push(e[a]);return i};if(l)if(l.value){for(var u in e){e[u][i].toString()===l.id.toString()&&(o=u)}e=d(e,o)}else e&&(o=e.indexOf(l))>=0&&(e=d(e,o));return e&&0===e.length&&(e=null),e},_colorMixer:function(){this.engine.searchAndStack(),this.engine.applyColors()},derivativeChange:function(){this._trigger("updateWells",null,this)},createState:function(){return{derivative:e.extend(!0,{},this.engine.derivative),checkboxes:this.getCheckboxes(),selectedIndices:this.selectedIndices.slice(),requiredField:this.requiredField}},getPlate:function(){var t={},i=this.engine.derivative;for(var a in i)if(i.hasOwnProperty(a)){var n=this.indexToAddress(a),l=i[a];t[n]=e.extend(!0,{},l)}return{wells:t,checkboxes:this.getCheckboxes(),selectedAddresses:this.getSelectedAddresses(),requiredField:this.requiredField}}}}}(jQuery),(plateLayOutWidget=plateLayOutWidget||{}).addDataToFields=function(){return{_addDataToTabFields:function(e){for(var t in this.fieldMap)this.fieldMap.hasOwnProperty(t)&&this._applyFieldData(t,e[t])},_applyFieldData:function(e,t){void 0===t&&(t=null),this.fieldMap[e].setValue(t)}}};plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.addTabData=function(){return{fieldList:[],fieldMap:{},autoId:1,_addTabData:function(){var e=this.options.attributes.tabs,t=this;this.requiredField=[];var i=[];e.forEach(function(e,a){if(e.fields){var n=e.fields,l=[];for(var s in n)if(n.hasOwnProperty(s)){var r=n[s];r.id||(r.id="Auto"+t.autoId++,console.log("Field autoassigned id "+r.id)),r.type||(r.type="text",console.log("Field "+r.id+" autoassigned type "+r.type));var o=void 0;"multiplex"===r.type?(o=t._makeMultiplexField(r,a,l),i.push(o)):(o=t._makeRegularField(r,a,l,!0),"multiselect"===r.type&&i.push(o))}t.allDataTabs[a].fields=l}else console.log("unknown format in field initialization")}),t.multipleFieldList=i},_makeSubField:function(t,i,a){t.id||(t.id="Auto"+this.autoId++,console.log("Field autoassigned id "+t.id)),t.type||(t.type="text",console.log("Field "+t.id+" autoassigned type "+t.type));var n=this._createElement("<div></div>").addClass("plate-setup-tab-default-field"),l=this._createElement("<div></div>").addClass("plate-setup-tab-field-left-side"),s=this._createElement("<div></div>").addClass("plate-setup-tab-field-right-side"),r=this._createElement("<div></div>").addClass("plate-setup-tab-name").text(t.name),o=this._createElement("<div></div>").addClass("plate-setup-tab-field-container");e(s).append(r),e(s).append(o),e(n).append(l),e(n).append(s),e(this.allDataTabs[i]).append(n);var d={id:t.id,name:t.name,root:n,data:t,required:t.required||!1};return a.push(d),this.fieldMap[t.id]=d,d},_makeRegularField:function(e,t,i,a){var n=this,l=n._createElement("<div></div>").addClass("plate-setup-tab-default-field"),s=n._createElement("<div></div>").addClass("plate-setup-tab-field-left-side"),r=n._createElement("<div></div>").addClass("plate-setup-tab-field-right-side "),o=n._createElement("<div></div>").addClass("plate-setup-tab-name").text(e.name),d=n._createElement("<div></div>").addClass("plate-setup-tab-field-container");r.append(o),r.append(d),l.append(s),l.append(r),n.allDataTabs[t].append(l);var u={id:e.id,name:e.name,root:l,data:e,required:e.required};return u.required&&n.requiredField.push(u.id),i.push(u),n.fieldList.push(u),n.fieldMap[u.id]=u,a&&n._addCheckBox(u),n._createField(u),u.onChange=function(){var e=u.getValue(),t={};t[u.id]=e,n._addAllData(t)},u},_makeMultiplexField:function(e,t,i){var a=this,n=a._createElement("<div></div>").addClass("plate-setup-tab-default-field"),l=a._createElement("<div></div>").addClass("plate-setup-tab-field-left-side"),s=a._createElement("<div></div>").addClass("plate-setup-tab-field-right-side "),r=a._createElement("<div></div>").addClass("plate-setup-tab-name").text(e.name),o=a._createElement("<div></div>").addClass("plate-setup-tab-field-container");s.append(r),s.append(o),n.append(l),n.append(s),a.allDataTabs[t].append(n);var d={id:e.id,name:e.name,root:n,data:e,required:e.required};i.push(d),a.fieldList.push(d),a.fieldMap[e.id]=d;var u=[],c=[];for(var f in e.multiplexFields)if(e.multiplexFields.hasOwnProperty(f)){var p=e.multiplexFields[f],h=a._makeSubField(p,t,i);u.push(h),p.required&&c.push(h.id)}return(d.required||c.length)&&this.requiredField.push({multiplexId:d.id,subFields:c}),d.subFieldList=u,a._createField(d),a._addCheckBox(d),u.forEach(function(e){e.mainMultiplexField=d,i.push(e),a._createField(e),a._addCheckBox(e),delete a.defaultWell[e.id],e.onChange=function(){var t=e.getValue(),i=e.mainMultiplexField,a=i.singleSelectValue(),n={};n[i.id]=a,n[e.id]=t;var l={id:a,value:n};d._changeMultiFieldValue(l,null);var s=i.detailData;null!==s&&(a=i.singleSelectValue(),s=s.map(function(n){return n[i.id]===a&&(n[e.id]=t),n})),i.detailData=s}}),d}}}}(jQuery);plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.addWarningMsg=function(){return{fieldWarningMsg:function(t,i,a){var n="fieldWarning"+t.id,l=e("<span>").html(this._assets.warningImg).attr("id",n).addClass("plate-field-warning-image");if(a){if(t.root.find("#"+n).length<=0){t.root.find(".plate-setup-tab-name").text(" "+t.name),t.root.find(".plate-setup-tab-name").prepend(l);var s=e("<div/>").addClass("pop-out-text");s.text(i),t.root.find(".plate-setup-tab-name").append(s),e("#"+n).hover(function(){s[0].style.display="flex"},function(){s.hide()})}}else t.root.find("#"+n).length>0&&(t.root.find(".plate-setup-tab-name").text(t.name),e("#"+n).remove())},removeWarningMsg:function(t,i,a){var n="fieldWarning"+t.id,l=e("<span>").html(this._assets.warningImg).attr("id",n).addClass("plate-field-warning-image");if(a){t.root.find(".plate-setup-tab-name").append(l);var s=e("<div/>").addClass("pop-out-text");s.text(i),t.root.find(".plate-setup-tab-name").append(s),e("#"+n).hover(function(){s[0].style.display="inline-block"},function(){s.hide()})}else e("#"+n).remove(),t.root.find("#"+n).length>0&&e("#"+n).remove()},applyFieldWarning:function(e){var t=this,i={};t.fieldList.forEach(function(e){i[e.id]=[]}),e.forEach(function(e){if(!t.engine.wellEmpty(e))for(var a in i)a in e?i[a].push(e[a]):i[a].push(null)});for(var a=0;a<t.fieldList.length;a++){var n=t.fieldList[a];if(n.applyMultiplexSubFieldColor)n.applyMultiplexSubFieldColor(i[n.id]);else if(n.required){var l=!1;i[n.id].forEach(function(e){e instanceof Array?0===e.length&&(l=!0):null===e&&(l=!0)}),t.fieldWarningMsg(n,"required field",l)}}}}}}(jQuery);plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.bottomTable=function(){return{_bottomScreen:function(){this.bottomContainer=this._createElement("<div></div>").addClass("plate-setup-bottom-container"),this.bottomTableContainer=this._createElement("<div></div>").addClass("plate-setup-bottom-table-container"),this.bottomTable=this._createElement("<table></table>").addClass("plate-setup-bottom-table"),this.bottomTableHead=this._createElement("<thead></thead>"),this.bottomTableBody=this._createElement("<tbody></tbody>"),this.bottomTable.append(this.bottomTableHead),this.bottomTable.append(this.bottomTableBody),this.bottomTableContainer.append(this.bottomTable),this.bottomContainer.append(this.bottomTableContainer),this.container.append(this.bottomContainer)},addBottomTableHeadings:function(){var e=this._createElement("<tr></tr>"),t=this._createElement("<th></th>").text("Group");e.prepend(t),this.rowCounter=1;for(var i=0;i<this.globalSelectedAttributes.length;i++){var a=this.globalSelectedAttributes[i],n=this.fieldMap[a],l=this._createElement("<th></th>").text(n.name);e.append(l),this.rowCounter=this.rowCounter+1}this.bottomTableBody.empty(),this.bottomTableHead.empty(),this.bottomTableHead.append(e),this.adjustFieldWidth(this.bottomRow)},tileAttrText:function(e,t){var i=this.engine.derivative[e.index];return this.fieldMap[t].getText(i[t])},addBottomTableRow:function(e,t){var i=this,a=this.allTiles[t[0]],n=this._createElement("<tr></tr>"),l=this._createElement("<td></td>").addClass("plate-setup-bottom-id"),s=this._createElement("<button/>");s.addClass("plate-setup-color-text"),s.text(e),l.append(s),s.click(function(e){var a=t.map(i.indexToAddress,i);e.ctrlKey&&i.getSelectedAddresses().forEach(function(e){a.indexOf(e)<0&&a.push(e)}),i.setSelectedAddresses(a)}),e>0&&(e=(e-1)%(this.colorPairs.length-1)+1);var r=this.colorPairs[e];l.css("background","linear-gradient(to right, "+r[0]+" , "+r[1]+")"),n.append(l);for(var o=0;o<this.globalSelectedAttributes.length;o++){var d=this.globalSelectedAttributes[o],u=this.tileAttrText(a,d),c=this._createElement("<td></td>").text(u);n.append(c)}this.bottomTableBody.append(n),this.adjustFieldWidth(n)},bottomForFirstTime:function(){this.addBottomTableHeadings();var e=this._createElement("<tr></tr>"),t=this.colorPairs[0],i=this._createElement("<td></td>");i.css("background","-webkit-linear-gradient(left, "+t[0]+" , "+t[1]+")"),e.append(i),this.bottomTableBody.append(e),this.createExportButton()},adjustFieldWidth:function(e){var t=this.rowCounter;150*t>1024&&e.css("width",152*t+"px")},downloadCSV:function(e,t){var i,a;i=new Blob([e],{type:"text/csv"}),(a=document.createElement("a")).download=t,a.href=window.URL.createObjectURL(i),a.style.display="none",document.body.appendChild(a),a.click()},exportData:function(e){var t=[],i=document.querySelectorAll("table tr"),a={},n=this.engine.stackUpWithColor;for(var l in n)n.hasOwnProperty(l)&&(a[l]=n[l].map(this.indexToAddress,this));for(var s=0;s<i.length;s++){for(var r=[],o=i[s].querySelectorAll("td, th"),d=0;d<o.length;d++){var u="";if(o[d].innerText&&(u="csv"===e?'"'+o[d].innerText.replace(/"/g,'""')+'"':o[d].innerText),r.push(u),0===s&&0===d&&("csv"===e?r.push('"Location"'):"clipboard"===e&&r.push("Location")),0!==s&&0===d){var c="";a[parseInt(o[d].innerText)]&&("csv"===e?c='"'+a[parseInt(o[d].innerText)].join(",")+'"':"clipboard"===e&&(c=a[parseInt(o[d].innerText)].join(","))),r.push(c)}}"csv"===e?t.push(r.join(",")):"clipboard"===e&&t.push(r.join("\t"))}if("csv"===e)this.downloadCSV(t.join("\n"),"table.csv");else if("clipboard"===e)return t.join("\n")},createExportButton:function(){var t=this,i=e("<div>").addClass("plate-setup-bottom-control-container"),a=e("<div>").addClass("plate-setup-overlay-text-container");a.text("Color groups"),i.append(a);var n=e("<div>").addClass("plate-setup-overlay-bottom-button-container"),l=e("<button/>").addClass("plate-setup-button");function s(){l.text("Export CSV"),l[0].classList.remove("plate-setup-clicked-button"),l.addClass("plate-setup-button")}l.text("Export CSV"),n.append(l),l.click(function(){t.exportData("csv"),l.text("Exported"),l[0].classList.remove("plate-setup-button"),l.addClass("plate-setup-clicked-button"),setTimeout(s,3e3)});var r=e("<button/>").addClass("plate-setup-button");r.text("Copy To Clipboard"),n.append(r);var o=new ClipboardJS(r.get(0),{text:function(){return t.exportData("clipboard")}});function d(){r.text("Copy To Clipboard"),r[0].classList.remove("plate-setup-clicked-button"),r.addClass("plate-setup-button")}o.on("success",function(){r.text("Copied as tab-delimited format"),r[0].classList.remove("plate-setup-button"),r.addClass("plate-setup-clicked-button"),setTimeout(d,3e3)}),o.on("error",function(){r.text("Failed to copy table to clipboard: browser may be incompatible"),setTimeout(d,3e3)}),i.append(n),this.bottomContainer.prepend(i)}}}}(jQuery);plateLayOutWidget=plateLayOutWidget||{};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){plateLayOutWidget.checkBox=function(){return{globalSelectedAttributes:[],_addCheckBox:function(t){var i=e("<span>").html(this._assets.dontImg).addClass("plate-setup-tab-check-box bg-light").data("clicked",!1);i.data("linkedFieldId",t.id),t.root.find(".plate-setup-tab-field-left-side").empty().append(i),this._applyCheckboxHandler(i),t.checkbox=i},_applyCheckboxHandler:function(t){var i=this;t.click(function(){var t=e(this),a={};a[t.data("linkedFieldId")]=!t.data("clicked"),i.changeCheckboxes(a)})},getCheckboxes:function(){var e=this.globalSelectedAttributes.slice();return Object.values(this.globalSelectedMultiplexSubfield).forEach(function(t){e=e.concat(t)}),e},changeSubFieldsCheckboxes:function(e,t){var i=this,a=[];return e.subFieldList.forEach(function(e){var n=e.checkbox,l=n.data("linkedFieldId"),s=n.data("clicked");l in t&&(s=Boolean(t[l])),n.data("clicked",s),s?(n.html(i._assets.doImg),a.push(e.id)):n.html(i._assets.dontImg)}),a},changeCheckboxes:function(e,t){for(var i=[],a={},n=0;n<this.fieldList.length;n++){var l=this.fieldList[n];if(l.checkbox){l.subFieldList&&(a[l.id]=this.changeSubFieldsCheckboxes(l,e));var s=l.checkbox,r=s.data("linkedFieldId"),o=s.data("clicked");r in e&&(o=Boolean(e[r])),s.data("clicked",o),o?(i.push(r),s.html(this._assets.doImg)):s.html(this._assets.dontImg)}}this.globalSelectedMultiplexSubfield=a,this.globalSelectedAttributes=i,this._clearPresetSelection(),this._colorMixer(),t||this.addToUndoRedo()},setSubFieldCheckboxes:function(e,t){var i=this,a=[];return e.subFieldList.forEach(function(e){var n=e.checkbox,l=n.data("linkedFieldId"),s=t.indexOf(l)>=0;n.data("clicked",s),s?(n.html(i._assets.doImg),a.push(e.id)):n.html(i._assets.dontImg)}),a},setCheckboxes:function(e,t){e=e||[];for(var i=[],a={},n=0;n<this.fieldList.length;n++){var l=this.fieldList[n];if(l.checkbox){l.subFieldList&&(a[l.id]=this.setSubFieldCheckboxes(l,e));var s=l.checkbox,r=s.data("linkedFieldId"),o=e.indexOf(r)>=0;s.data("clicked",o),o?(i.push(r),s.html(this._assets.doImg)):s.html(this._assets.dontImg)}}this.globalSelectedMultiplexSubfield=a,this.globalSelectedAttributes=i,this._clearPresetSelection(),this._colorMixer(),t||this.addToUndoRedo()}}}}(jQuery),(plateLayOutWidget=plateLayOutWidget||{}).colorManager=function(){return{colorPairs:[["#e6e6e6","#808080"],["#66e8ff","#0082c8"],["#ff7fb1","#e6194b"],["#a2ffb1","#3cb44b"],["#f784ff","#911eb4"],["#ffe897","#f58231"],["#6666ff","#0000FF"],["#ffff7f","#ffe119"],["#acffff","#46f0f0"],["#ff98ff","#f032e6"],["#ffffa2","#d2f53c"],["#ffffff","#fabebe"],["#66e6e6","#008080"],["#ffffff","#e6beff"],["#ffd48e","#aa6e28"],["#e66666","#800000"],["#ffffff","#aaffc3"],["#e6e666","#808000"],["#ffffff","#ffd8b1"],["#66a9ef","#004389"],["#ff6672","#a7000c"],["#66db72","#00750c"],["#b866db","#520075"],["#ffa966","#b64300"],["#ffff66","#c0a200"],["#6dffff","#07b1b1"],["#ff66ff","#b100a7"],["#f9ff66","#93b600"],["#ffe5e5","#bb7f7f"],["#66a7a7","#004141"],["#ffe5ff","#a77fc0"],["#d19566","#6b2f00"],["#ffffef","#c0bb89"],["#d1ffea","#6bc084"],["#a7a766","#414100"],["#ffffd8","#c09972"],["#a5ffff","#3fc1ff"],["#ffbef0","#ff588a"],["#e1fff0","#7bf38a"],["#ffc3ff","#d05df3"],["#ffffd6","#ffc170"],["#a5a5ff","#3f3fff"],["#ffffbe","#ffff58"],["#ebffff","#85ffff"],["#ffd7ff","#ff71ff"],["#a5ffff","#3fbfbf"],["#ffffcd","#e9ad67"],["#ffa5a5","#bf3f3f"],["#ffffa5","#bfbf3f"]]}};plateLayOutWidget=plateLayOutWidget||{};!function(e){function t(t){t.params.args.originalEvent?t.params.args.originalEvent.stopPropagation():e(this).one("select2:opening",function(e){e.preventDefault()})}function i(e){e.on("select2:unselecting",t)}function a(e,t,i){e.empty();var a=e.data("select2").dataAdapter;a.addOptions(a.convertToOptions(t)),e.val(i)}plateLayOutWidget.createField=function(){return{_createField:function(e){switch(e.data.type){case"text":this._createTextField(e);break;case"numeric":this._createNumericField(e);break;case"select":this._createSelectField(e);break;case"multiselect":this._createMultiSelectField(e);break;case"boolean":this._createBooleanField(e);break;case"multiplex":this._createMultiplexField(e)}},_createTextField:function(e){var t=e.id,i=this._createElement("<input>").attr("id",t).addClass("plate-setup-tab-input");e.root.find(".plate-setup-tab-field-container").append(i),this.defaultWell[t]=null,e.parseValue=function(e){return e=e?String(e):null},e.getValue=function(){return i.val().trim()||null},e.setValue=function(e){i.val(e)},e.getText=function(e){return null==e?"":e},e.disabled=function(t){e.input.prop("disabled",t)},e.parseText=e.parseValue,i.on("input",function(){e.onChange()}),e.input=i},_createOpts:function(e){var t={allowClear:!0,placeholder:"select",minimumResultsForSearch:10},i=!1;if(e.options&&(t.data=e.options,i=!0),e.ajax&&(t.ajax=ajax,i=!0),!i)throw"Must specify data or ajax";return t},_createSelectField:function(e){var t=e.id,a=this._createElement("<select/>").attr("id",t).addClass("plate-setup-tab-select-field");e.root.find(".plate-setup-tab-field-container").append(a),this.defaultWell[t]=null;var n=this._createOpts(e.data),l={};n.data.forEach(function(e){l[String(e.id)]=e}),a.select2(n),i(a),e.parseValue=function(e){var i=e;if(""===i&&(i=null),null==i)return null;if((i=String(i))in l)return l[i].id;throw"Invalid value "+e+" for select field "+t},e.disabled=function(t){e.input.prop("disabled",t)},e.getValue=function(){return e.parseValue(a.val())},e.setValue=function(e){a.val(e),a.trigger("change.select2")},e.getText=function(e){return null==e?"":l[String(e)].text},e.parseText=function(e){var i=e;if(""===i&&(i=null),null==i)return null;if((i=String(i))in l)return l[i].text;throw"Invalid text value "+e+" for select field "+t},a.on("change",function(){e.onChange()}),e.input=a},_createMultiSelectField:function(e){var t=e.id,a=this,n=this._createElement("<select/>").attr("id",t).addClass("plate-setup-tab-multiselect-field");n.attr("multiple","multiple"),e.root.find(".plate-setup-tab-field-container").append(n),a.defaultWell[t]=null;var l=a._createOpts(e.data);l.multiple=!0;var s={};l.data.forEach(function(e){s[String(e.id)]=e}),n.select2(l),i(n),e.disabled=function(e){n.prop("disabled",e)},e._parseOne=function(e){if((e=String(e))in s)return s[e].id;throw"Invalid value "+e+" for multiselect field "+t},e._parseMany=function(t){return t=t&&t.length?t.map(e._parseOne,this):null},e.parseValue=function(t){return e._parseMany(t)},e.getValue=function(){return e._parseMany(n.val())},e.setValue=function(e){e=e||[],n.val(e),n.trigger("change.select2")},e.getText=function(e){return null==e?"":e.length>0?e.map(function(e){return s[String(e)].text}).join("; "):""},e.multiOnChange=function(t,i){t&&(t=t.id),i&&(i=i.id);var n={};n[e.id]={multi:!0,added:t,removed:i},a._addAllData(n)},e.parseText=function(e){var i=e;return i=i&&i.length?i.map(function(e){if((e=String(e))in s)return s[e].text;throw"Invalid text value "+e+" for multiselect field "+t}):null},n.on("select2:select",function(t){var i=e._parseOne(t.params.data.id);i={id:i},e.multiOnChange(i,null)}),n.on("select2:unselect",function(t){var i=e._parseOne(t.params.data.id);i={id:i},e.multiOnChange(null,i)}),e.input=n,a._createDeleteButton(e)},_createNumericField:function(t){var i=t.id,n=t.data,l=this._createElement("<input>").addClass("plate-setup-tab-input").attr("placeholder",n.placeholder||"").attr("id",i);t.root.find(".plate-setup-tab-field-container").append(l),this.defaultWell[i]=null;var s=n.units||[],r=n.defaultUnit||null,o=null;if(r?s.length?s.indexOf(r)<0&&(r=s[0]):s=[r]:s.length&&(r=s[0]),s.length)if(t.units=s,t.hasUnits=!0,t.defaultUnit=r,1===s.length){var d=e("<div></div>").addClass("plate-setup-tab-unit");d.text(r),t.root.find(".plate-setup-tab-field-container").append(d)}else{o=this._createElement("<select/>").attr("id",i).addClass("plate-setup-tab-label-select-field"),t.root.find(".plate-setup-tab-field-container").append(o);var u=null,c={data:s.map(function(e){return e===r&&(u=e),{id:e,text:e}}),allowClear:!1,minimumResultsForSearch:10};o.select2(c),o.val(u)}t.disabled=function(e){t.input.prop("disabled",e),o&&o.prop("disabled",e)},t.setUnitOpts=function(e){t.units=e||null,t.defaultUnit=null;var i=[],n=null;t.units&&t.units.length&&(t.defaultUnit=t.units[0],i=t.units.map(function(e){var i={id:e,text:e};return e===t.defaultUnit&&(n=e),i})),a(o,i,n)},t.parseValue=function(a){var n;if(e.isPlainObject(a)){if(t.hasUnits)return null===(n=t.parseRegularValue(a.value))?null:{value:n,unit:t.parseUnit(a.unit)};throw"Value must be plain numeric for numeric field "+i}return t.hasUnits?null===(n=t.parseRegularValue(a))?null:{value:n,unit:t.defaultUnit}:t.parseRegularValue(a)},t.getValue=function(){var e=t.getRegularValue();if(null===e||isNaN(e))return null;if(!t.hasUnits)return e;var i=function(){var i={value:e,unit:t.getUnit()};if(t.data.hasMultiplexUnit){var a=t.data.unitMap,n=function(e){if(!a.hasOwnProperty(e))return"continue";a[e].forEach(function(t){t.text===i.unit&&(i.unitTypeId=e,i.unitId=t.id)})};for(var l in a)n(l)}return{v:i}}();return"object"===_typeof(i)?i.v:void 0},t.setValue=function(i){t.hasUnits?e.isPlainObject(i)?(t.setUnit(i.unit||t.defaultUnit),t.setRegularValue(i.value)):(t.setRegularValue(i),t.setUnit(t.defaultUnit)):t.setRegularValue(i)},t.parseRegularValue=function(e){if(null==e)return null;var t=String(e).trim();if(""===t)return null;if(t=Number(e),isNaN(t))throw"Invalid value "+e+" for numeric field "+i;return t},t.getRegularValue=function(){var e=l.val().trim();return e=""===e?null:Number(e)},t.setRegularValue=function(e){l.val(e)},t.parseUnit=function(e){if(null==e||""===e)return t.defaultUnit;for(var a=0;a<s.length;a++)if(e.toLowerCase()===s[a].toLowerCase())return s[a];throw"Invalid unit "+e+" for field "+i},t.getUnit=function(){return o?o.val():t.defaultUnit},t.setUnit=function(e){o&&(e=e||t.defaultUnit,o.val(e),o.trigger("change.select2"))},t.getText=function(e){if("object"===_typeof(e)&&e){var i=e.value,a=e.unit;return null==i?"":(i=i.toString(),a||(a=r),a&&(i=i+" "+a),i)}return t.getRegularText(e)},t.getRegularText=function(e){return null==e?"":e=e.toString()},t.parseText=function(e){var i=t.parseValue(e);return i&&"object"===_typeof(i)?i.value+i.unit:i||null},l.on("input",function(){var e=t.getRegularValue();isNaN(e)?l.addClass("invalid"):l.removeClass("invalid"),t.onChange()}),o&&o.on("change",function(){t.onChange()}),t.input=l,t.unitInput=o},_createBooleanField:function(e){var t=e.id,a=this._createElement("<select/>").attr("id",t).addClass("plate-setup-tab-select-field");this.defaultWell[t]=null,e.root.find(".plate-setup-tab-field-container").append(a);var n={data:[{id:"true",text:"true"},{id:"false",text:"false"}],placeholder:"select",allowClear:!0,minimumResultsForSearch:-1};a.select2(n),i(a),e.disabled=function(t){e.input.prop("disabled",t)},e.parseValue=function(e){if(null==e)return null;var i=String(e).trim().toLowerCase();if("true"===i)i=!0;else if("false"===i)i=!1;else{if(""!==i)throw"Invalid value "+e+" for boolean field "+t;i=null}return i},e.getValue=function(){switch(a.val()){case"true":return!0;case"false":return!1;default:return null}},e.setValue=function(e){e=1===e||!0===e||"true"===e?"true":0===e||!1===e||"false"===e?"false":null,a.val(e),a.trigger("change.select2")},e.getText=function(e){return null==e?"":e.toString()},e.parseText=e.parseValue,a.on("change",function(){e.onChange()}),e.input=a},_createMultiplexField:function(e){var t=this;this._createMultiSelectField(e),t.defaultWell[e.id]=[];var n=t._createElement("<div></div>").addClass("plate-setup-tab-name-singleSelect").text("Select to edit"),l=t._createElement("<div></div>").addClass("plate-setup-tab-field-container-singleSelect");e.root.find(".plate-setup-tab-field-right-side").append(n,l),e.singleSelect=this._createElement("<select/>").attr("id",e.id+"SingleSelect").addClass("plate-setup-tab-multiplex-single-select-field"),e.singleSelect.appendTo(l);e.singleSelect.select2({allowClear:!1,placeholder:"select",minimumResultsForSearch:10,data:[]}),i(e.singleSelect);var s=e.setValue;e.singleSelectValue=function(){var t=e.singleSelect.val();return""===t?null:null==t?null:e._parseOne(t)};var r=function(t,i){t=t||[],i||(i=t.length?t[0].id:null),a(e.singleSelect,t,i),e.singleSelect.prop("disabled",0===t.length),e.singleSelect.trigger("change.select2")},o=function(){var i=e.singleSelectValue();e.updateSubFieldUnitOpts(i);var a=e.detailData||[],n=null;a.forEach(function(t){t[e.id]===i&&(n=t)}),n?e.subFieldList.forEach(function(e){e.disabled(!1),e.setValue(n[e.id])}):e.subFieldList.forEach(function(e){e.disabled(!0),e.setValue(null)}),t.readOnlyHandler()};r([]),e.singleSelect.on("change.select2",o),e._changeMultiFieldValue=function(i,a){var n,l={};for(var s in e.data.multiplexFields){if(e.data.multiplexFields.hasOwnProperty(s))l[e.data.multiplexFields[s].id]=null}i&&(i.value?n=i.value:(l[e.id]=i.id,n=l),i={id:i.id,value:n}),a&&(a.value?n=a.value:(l[e.id]=a.id,n=l),a={id:a.id,value:n});var r={};r[e.id]={multi:!0,added:i,removed:a},t._addAllData(r)},e.setValue=function(t){e.detailData=t;var i=null;t&&t.length&&(i=t.map(function(t){return t[e.id]})),s(i);var a=e.input.select2("data")||[];r(a),o()},e.disabled=function(t){e.input.prop("disabled",t),e.subFieldList.forEach(function(e){e.disabled(t)}),t?n.text("Select to inspect"):n.text("Select to edit")},e.parseValue=function(t){var i=t;return i=i&&i.length?i.map(function(t){var i={};i[e.id]=t[e.id];var a=function(a){t.hasOwnProperty(a)&&e.subFieldList.forEach(function(e){e.id===a&&(i[e.id]=e.parseValue(t[a]))})};for(var n in t)a(n);return i}):null},e.updateSubFieldUnitOpts=function(t){var i;e.data.options.forEach(function(e){e.id===t&&(i=e)}),e.subFieldList.forEach(function(e){e.data.hasMultiplexUnit&&(i&&i.hasOwnProperty("unitOptions")?e.setUnitOpts(i.unitOptions[e.id]):e.setUnitOpts(null))})},e.multiOnChange=function(t,i){e._changeMultiFieldValue(t,i);var a=e.getValue(),n=e.detailData,l=[],s=null;n&&(l=n.map(function(t){return t[e.id]}));var d=[],u=[];if(a){a.forEach(function(t){if(n&&n.forEach(function(i){i[e.id]===t&&d.push(i)}),l.indexOf(t)<0){var i={};i[e.id]=t,e.updateSubFieldUnitOpts(t),e.subFieldList.forEach(function(a){if(a.hasUnits)if(a.data.hasMultiplexUnit)a.disabled(!1),e.data.options.forEach(function(e){if(e.id===t){var n={value:null,unit:a.units[0]};i[a.id]=a.parseValue(n)}});else{a.data.units&&a.data.units.length>1&&a.disabled(!1);var n={value:null,unit:a.defaultUnit};i[a.id]=a.parseValue(n)}else i[a.id]=a.parseValue(null)}),d.push(i)}}),a.forEach(function(t){e.data.options.forEach(function(e){e.id===t&&u.push(e)})});for(var c=e.singleSelectValue(),f=0;f<a.length;f++){if(t&&t.id===a[f]){s=a[f];break}0===f?s=a[f]:a[f]===c&&(s=a[f])}}e.detailData=d,r(u,s),o()},e.getText=function(i){if(null===i)return"";if(e.id in t.globalSelectedMultiplexSubfield){var a=function(){var a=t.globalSelectedMultiplexSubfield[e.id],n=[],l=function(t){if(!i.hasOwnProperty(t))return"continue";var l=i[t],s=[];for(var r in e.data.options)if(e.data.options.hasOwnProperty(r)){var o=e.data.options[r];o.id===l[e.id]&&s.push(o.text)}e.subFieldList.forEach(function(e){if(a.indexOf(e.id)>=0){var t=e.getText(l[e.id]);s.push(e.name+": "+t)}}),n.push("{"+s.join(", ")+"}")};for(var s in i)l(s);return{v:n.join(";")}}();if("object"===_typeof(a))return a.v}},e.parseText=function(t){if(null===t)return"";var i=[],a=function(a){if(!t.hasOwnProperty(a))return"continue";var n=t[a],l=[];for(var s in e.data.options)if(e.data.options.hasOwnProperty(s)){var r=e.data.options[s];r.id===n[e.id]&&l.push(r.text)}e.subFieldList.forEach(function(e){var t=e.getText(n[e.id]);t&&l.push(t)}),i.push(l)};for(var n in t)a(n);return i},e.checkMultiplexCompletion=function(t){var i=0,a=0,n=!1;function l(t){var i=0,a=0;for(var l in e.subFieldList)if(e.subFieldList.hasOwnProperty(l)){var s=e.subFieldList[l],r=t[s.id];s.required&&(n=!0,i++,"object"===_typeof(r)&&r?r.value&&a++:r&&a++)}return a/i}if(t)if(t.length>0)for(var s in t){if(t.hasOwnProperty(s))i++,a+=l(t[s])}else e.required&&(n=!0,i=1);else e.required&&(n=!0,i=1);return{include:n,completionPct:a/i}},e.applyMultiplexSubFieldColor=function(i){var a={};e.subFieldList.forEach(function(e){e.required&&(a[e.id]={field:e,warningStatus:[]})}),i.forEach(function(t){!function(t){for(var i in e.subFieldList)if(e.subFieldList.hasOwnProperty(i)){var n=e.subFieldList[i];if(null===t)e.required&&n.required&&a[n.id].warningStatus.push(!0);else if("object"===_typeof(t))if(0===t.length)e.required&&n.required&&a[n.id].warningStatus.push(!0);else for(var l in t)if(t.hasOwnProperty(l)){var s=t[l][n.id];n.required&&("object"===_typeof(s)&&s?s.value?a[n.id].warningStatus.push(!1):a[n.id].warningStatus.push(!0):s?a[n.id].warningStatus.push(!1):a[n.id].warningStatus.push(!0))}}}(t)});var n=[];for(var l in a)if(a.hasOwnProperty(l)){var s=a[l].field;if(a[l].warningStatus.indexOf(!0)>=0){var r=s.name+" is a required subfield for "+e.name+", please make sure all "+e.name+" have "+s.name;e.required,t.fieldWarningMsg(s,r,!0),n.push(!0)}else t.fieldWarningMsg(s,"none",!1),n.push(!1)}var o,d=n.indexOf(!0)>=0;o=e.required?e.name+" is a required field, please also fix missing required subfield(s) below":e.name+" is not a required field, please fix missing required subfield(s) below or remove selected "+e.name,t.fieldWarningMsg(e,o,d)},e.parseMainFieldVal=function(t){for(var i=e.data.options,a=0;a<i.length;a++){var n=i[a];if(n.id===t)return n.text}}},_deleteDialog:function(t){var i,a=this,n=t.allSelectedMultipleVal;i=n?Object.keys(n):[];var l=e("<div/>").addClass("plate-modal");function s(){l.hide(),l.remove()}this.container.append(l);var r=e("<div/>").addClass("plate-modal-content").css("width","550px").appendTo(l),o=e("<div/>").appendTo(r),d=e("<div/>").addClass("dialog-buttons").css("justify-content","flex-end").appendTo(r);if(i.length>0){e("<p/>").text(t.name+" in selected wells: choose items to delete and click the delete button below").appendTo(o);var u=a._deleteDialogTable(t,n);if(u.appendTo(o),u.addClass("plate-popout-table"),u.find("td").addClass("plate-popout-td"),u.find("th").addClass("plate-popout-th"),u.find("tr").addClass("plate-popout-tr"),!a.readOnly){var c=e("<button class='multiple-field-manage-delete-button'>Delete Checked Items</button>");d.append(c),c.click(function(){u.find("input:checked").each(function(){var e=this.value;t.multiOnChange(null,{id:e})}),a.decideSelectedFields(),s()})}}else e("<p/>").text("No "+t.name+" in the selected wells").appendTo(o);var f=e("<button>Cancel</button>");d.append(f),f.click(s),l.show(),window.onclick=function(e){e.target===l[0]&&s()}},_deleteDialogTable:function(t,i){var a=this,n=[t.name,"Counts"];a.readOnly||n.push("Delete");var l=e("<table/>"),s=e("<thead/>").appendTo(l);e("<tr/>").appendTo(s).append(n.map(function(t){return e("<th/>").text(t)}));var r=e("<tbody/>").appendTo(l);return t.data.options.forEach(function(t){if(t.id in i){var n=e("<tr/>").appendTo(r),l=e("<input type='checkbox'>").prop("value",t.id);e("<td/>").text(t.text).appendTo(n),e("<td/>").text(i[t.id]).appendTo(n),a.readOnly||e("<td/>").append(l).appendTo(n)}}),l},_createDeleteButton:function(t){var i=this,a=e("<button/>").addClass("plate-setup-remove-all-button");a.id=t.id+"Delete",a.text("Manage "+t.name+"...");var n=i._createElement("<div></div>").addClass("plate-setup-remove-all-button-container");n.append(a),t.deleteButton=a,t.root.find(".plate-setup-tab-field-right-side").append(n),a.click(function(){i._deleteDialog(t)})}}}}(jQuery);plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.engine=function(t){return{engine:{derivative:{},colorMap:new Map,stackUpWithColor:{},stackPointer:2,wellEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];if(null!=i){if(!Array.isArray(i))return!1;if(i.length>0)return!1}}return!0},searchAndStack:function(){this.stackUpWithColor={},this.stackPointer=1;var i={};for(var a in this.derivative)if(this.derivative.hasOwnProperty(a)){for(var n=this.derivative[a],l={},s=0;s<t.globalSelectedAttributes.length;s++){var r=t.globalSelectedAttributes[s];if(r in t.globalSelectedMultiplexSubfield){var o=t.globalSelectedMultiplexSubfield[r],d=[],u=function(e){if(!n[r].hasOwnProperty(e))return"continue";var t=n[r][e],i={};i[r]=t[r],o.forEach(function(e){i[e]=t[e]}),d.push(i)};for(var c in n[r])u(c);l[r]=d}else null!=n[r]&&(l[r]=n[r])}e.isEmptyObject(l)?i[a]=null:i[a]=JSON.stringify(l)}for(;!e.isEmptyObject(i);){var f=Object.keys(i).map(parseFloat);f.sort(function(e,t){return e-t});var p=f[0],h=i[p],v=[];if(h){for(var b=0;b<f.length;b++){var g=f[b];h===i[g]&&(v.push(g),this.stackUpWithColor[this.stackPointer]=v,delete i[g])}v.length>0&&this.stackPointer++}else this.stackUpWithColor[0]?this.stackUpWithColor[0].push(p):this.stackUpWithColor[0]=[p],delete i[p]}},applyColors:function(){var e=0,i=0;t.addBottomTableHeadings();for(var a=0;a<t.allTiles.length;a++){var n=t.allTiles[a];t.setTileVisible(n,!1)}for(var l=0;l<this.stackPointer;l++){var s=this.stackUpWithColor[l];if(s){t.addBottomTableRow(l,s);for(var r=0;r<s.length;r++){e++;var o=this.stackUpWithColor[l][r],d=t.allTiles[o],u=this.derivative[o];this.colorMap.set(o,l),t.setTileColor(d,l);var c=this.checkCompletion(u,d);t.setTileComplete(d,1===c),i+=c}}}i=Math.floor(100*i/e),isNaN(i)?t.overLayTextContainer.text("Completion Percentage: 0%"):t.overLayTextContainer.text("Completion Percentage: "+i+"%"),t.selectObjectInBottomTab()},checkCompletion:function(e){for(var i=0,a=0,n=0;n<t.fieldList.length;n++){var l=t.fieldList[n];if(l.checkMultiplexCompletion){var s=l.checkMultiplexCompletion(e[l.id]);s.include&&(a+=s.completionPct,i++)}else l.required&&(i++,null!==e[l.id]&&a++)}return i===a?1:a/i}}}}}(jQuery),(plateLayOutWidget=plateLayOutWidget||{}).assets=function(){return{_assets:{doImg:"&#10003;",dontImg:"",warningImg:"&#9888;"}}};plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.interface=function(){return{_createInterface:function(){this.container=this._createElement("<div></div>").addClass("plate-setup-wrapper"),this.topSection=this._createElement("<div></div>").addClass("plate-setup-top-section"),this.topLeft=this._createElement("<div></div>").addClass("plate-setup-top-left"),this.topRight=this._createElement("<div></div>").addClass("plate-setup-top-right"),this.overLayContainer=this._createElement("<div></div>").addClass("plate-setup-overlay-container"),this.canvasContainer=this._createElement("<div></div>").addClass("plate-setup-canvas-container"),this._createOverLay(),e(this.topLeft).append(this.overLayContainer),e(this.topLeft).append(this.canvasContainer),e(this.topSection).append(this.topLeft),e(this.topSection).append(this.topRight),e(this.container).append(this.topSection),e(this.element).append(this.container),this._createSvg(),this._createTabAtRight(),this._createTabs(),this._placePresetTabs(),this._bottomScreen(),this.bottomForFirstTime();var t=this;this._setShortcuts(),e(document.body).keyup(function(e){t._handleShortcuts(e)}),this._configureUndoRedoArray()},_createElement:function(t){return e(t)},_setShortcuts:function(){var e=this;window.addEventListener("cut",function(t){document.activeElement===document.body&&(e.copyCriteria(),e.clearCriteria(),t.preventDefault())}),window.addEventListener("copy",function(t){document.activeElement===document.body&&(e.copyCriteria(),t.preventDefault())}),window.addEventListener("paste",function(t){document.activeElement===document.body&&(e.pasteCriteria(),t.preventDefault())})},_handleShortcuts:function(e){document.activeElement===document.body&&(46===e.keyCode?(this.clearCriteria(),e.preventDefault()):(e.ctrlKey||e.metaKey)&&(90===e.keyCode?(e.shiftKey?this.redo():this.undo(),e.preventDefault()):89===e.keyCode&&(this.redo(),e.preventDefault())))}}}}(jQuery),(plateLayOutWidget=plateLayOutWidget||{}).loadPlate=function(){return{loadPlate:function(e){var t={};for(var i in e.wells){var a=e.wells[i];t[this.addressToIndex(i)]=this.sanitizeWell(a)}var n=e.checkboxes||[],l=this.sanitizeAddresses(e.selectedAddresses);0===l.length&&(l=[0]);var s={derivative:t,checkboxes:n,selectedIndices:l};this.setData(s)},sanitizeAddresses:function(e){var t=(e=e||[]).map(this.addressToIndex,this);return t.sort(),t=t.filter(function(e,i){return t.indexOf(e)===i})},sanitizeWell:function(e){var t={};return this.fieldList.forEach(function(i){t[i.id]=i.parseValue(e[i.id])}),t},setData:function(e,t){this.engine.derivative=e.derivative,this.setCheckboxes(e.checkboxes,!0),this.setSelectedIndices(e.selectedIndices,!0),this.derivativeChange(),t||this.addToUndoRedo()}}};plateLayOutWidget=plateLayOutWidget||{};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){plateLayOutWidget.overlay=function(){return{_createOverLay:function(){var e=this;this.overLayTextContainer=this._createElement("<div></div>").addClass("plate-setup-overlay-text-container"),this.overLayTextContainer.text("Completion Percentage:"),this.overLayContainer.append(this.overLayTextContainer),this.overLayButtonContainer=this._createElement("<div></div>").addClass("plate-setup-overlay-button-container"),this.overLayContainer.append(this.overLayButtonContainer),this.clearCriteriaButton=this._createElement("<button />").addClass("plate-setup-button"),this.clearCriteriaButton.text("Clear"),this.overLayButtonContainer.append(this.clearCriteriaButton),this.clearCriteriaButton.click(function(){e.clearCriteria()}),this.copyCriteriaButton=this._createElement("<button />").addClass("plate-setup-button"),this.copyCriteriaButton.text("Copy"),this.overLayButtonContainer.append(this.copyCriteriaButton),this.copyCriteriaButton.click(function(){e.copyCriteria()}),this.pasteCriteriaButton=this._createElement("<button />").addClass("plate-setup-button"),this.pasteCriteriaButton.text("Paste"),this.overLayButtonContainer.append(this.pasteCriteriaButton),this.pasteCriteriaButton.click(function(){e.pasteCriteria()}),this.undoButton=this._createElement("<button />").addClass("plate-setup-button"),this.undoButton.text("Undo"),this.overLayButtonContainer.append(this.undoButton),this.undoButton.click(function(){e.undo()}),this.redoButton=this._createElement("<button />").addClass("plate-setup-button"),this.redoButton.text("Redo"),this.overLayButtonContainer.append(this.redoButton),this.redoButton.click(function(){e.redo()})},clearCriteria:function(){if(this.selectedIndices&&this.selectedIndices.length){for(var t,i=!1,a=this.selectedIndices,n=0;n<a.length;n++){var l=a[n];l in this.engine.derivative&&(this.disableAddDeleteWell?this.engine.derivative.hasOwnProperty(l)&&(t=e.extend(!0,{},this.emptyWellWithDefaultVal),this.engine.derivative[l]=t):delete this.engine.derivative[l],i=!0)}i&&(this._colorMixer(),this.decideSelectedFields(),this.derivativeChange(),this.addToUndoRedo())}else alert("Please select any well")},copyCriteria:function(){if(this.selectedIndices&&this.selectedIndices.length){var e=this._getSelectedWells();this.commonWell=this._getCommonWell(e)}else alert("Please select any well.")},pasteCriteria:function(){this.commonWell&&(this._addAllData(this.commonWell),this.decideSelectedFields())}}}}(jQuery),$.widget("DNA.plateLayOut",{plateLayOutWidget:{},options:{value:0},addressToLoc:function(e){var t=/^([A-Z]+)(\d+)$/.exec(e.trim().toUpperCase());if(t){for(var i=t[1],a=parseInt(t[2])-1,n=0,l=0;l<i.length;l++){var s=i.charCodeAt(l)-65;l?(n+=1,n*=26,n+=s):n=s}return{r:n,c:a}}throw e+" not a proper layout address"},locToIndex:function(e,t){if(t||(t=this.dimensions),!(e.r>=0&&e.r<t.rows))throw"Row index "+(e.r+1)+" invalid";if(!(e.c>=0&&e.c<t.cols))throw"Column index "+(e.c+1)+" invalid";return e.r*t.cols+e.c},addressToIndex:function(e,t){var i=this.addressToLoc(e);return this.locToIndex(i,t)},_rowKey:function(e){var t=e%26,i=(e-t)/26,a=String.fromCharCode(65+t);return i>0&&(a=String.fromCharCode(64+i)+a),a},_colKey:function(e){return(e+1).toString(10)},indexToLoc:function(e,t){if(t||(t=this.dimensions),e>=t.rows*t.cols)throw"Index too high: "+e.toString(10);var i={};return i.c=e%t.cols,i.r=(e-i.c)/t.cols,i},locToAddress:function(e){return this._rowKey(e.r)+this._colKey(e.c)},indexToAddress:function(e,t){var i=this.indexToLoc(e,t);return this.locToAddress(i)},getDimensions:function(){return $.extend(!0,{},this.dimensions)},_create:function(){var e=parseInt(this.options.numRows||8),t=parseInt(this.options.numCols||12);this.dimensions={rows:e,cols:t},this.rowIndex=[];for(var i=0;i<e;i++)this.rowIndex.push(this._rowKey(i));for(var a in this.target=this.element[0].id?"#"+this.element[0].id:"."+this.element[0].className,this.options.readOnly&&this.isReadOnly(!0),plateLayOutWidget)plateLayOutWidget.hasOwnProperty(a)&&$.extend(this,new plateLayOutWidget[a](this));return this._createInterface(),this._trigger("created",null,this),this},_init:function(){},getTextDerivative:function(e){var t={},i=this.fieldMap;for(var a in e)if(e.hasOwnProperty(a)){var n={},l={},s=e[a];for(var r in s)if(s.hasOwnProperty(r))if(r in i){var o=i[r],d=o.parseText(s[r]);l[o.name]=d,n[r]=d}else l[r]=s[r],n[r]=s[r];t[a]={textVal:n,textFieldVal:l}}return t},getWellsDifferences:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);var a={};if(t.length>1){var n=this._getCommonWell(t),l={};for(var s in t[0])t[0].hasOwnProperty(s)&&(l[s]=[]);for(var r in e)if(e.hasOwnProperty(r)){var o={},d=e[r];for(var u in d)if(d.hasOwnProperty(u)){var c=n[u],f=d[u];void 0===c&&(c=null),void 0===f&&(f=null);var p=null;if(Array.isArray(f)){c=c||[],p=[];for(var h=0;h<f.length;h++){var v=f[h];v&&"object"===_typeof(v)?this.containsObject(v,c)||(p.push(v),this.containsObject(v,l[u])||l[u].push(v)):c.indexOf(v)<0&&(p.push(v),!l[u].indexOf(v)>=0&&l[u].push(v))}}else f&&"object"===_typeof(f)?c&&"object"===_typeof(c)?f.value!==c.value&&f.unit!==c.unit&&(p=f,this.containsObject(f,l[u])||l[u].push(f)):(p=f,this.containsObject(f,l[u])||l[u].push(f)):f!==c&&(p=f,!l[u].indexOf(f)>=0&&l[u].push(f));o[u]=p}a[r]=o}for(var b in l)if(l.hasOwnProperty(b)&&0===l[b].length)for(var g in a)a.hasOwnProperty(g)&&delete a[g][b];return a}if(t.length>0){var m={};for(var y in e)if(e.hasOwnProperty(y)){var C={},x=e[y];for(var _ in x)if(x.hasOwnProperty(_)){var S=x[_];Array.isArray(S)?S.length>0&&(C[_]=S):S&&(C[_]=S)}m[y]=C}return m}},setFieldsDisabled:function(e){this.fieldList.forEach(function(t){t.disabled(e)})},isReadOnly:function(e){this.readOnly=!!e,this.readOnlyHandler()},readOnlyHandler:function(){this.readOnly?(this.overLayButtonContainer.css("display","none"),$(".multiple-field-manage-delete-button").css("display","none"),this.setFieldsDisabled(!0)):(this.overLayButtonContainer.css("display","flex"),$(".multiple-field-manage-delete-button").css("display","none"),this.disableAddDeleteWell||this.setFieldsDisabled(!1))},disableAddDeleteWell:null,isDisableAddDeleteWell:function(e,t){if(e){var i=$.extend(!0,{},this.defaultWell);if(t)for(var a in t)t.hasOwnProperty(a)&&(a in i?i[a]=t[a]:console.log("No field for key: "+key+", please contact support"));this.disableAddDeleteWell=!0,this.addressAllowToEdit=this.getWellSetAddressWithData(),this.actionPointer=0,this.undoRedoArray=[this.createState()],this.emptyWellWithDefaultVal=i}else this.disableAddDeleteWell=!1,this.setFieldsDisabled(!1),this.emptyWellWithDefaultVal=null},selectObjectInBottomTab:function(){for(var e=[],t=this.selectedIndices,i=0;i<t.length;i++){var a=t[i];if(this.engine.derivative[a]){var n=this.engine.colorMap.get(a);e.indexOf(n)<0&&e.push(n)}}for(var l=document.querySelectorAll("table.plate-setup-bottom-table tr"),s=1;s<l.length;s++){var r=l[s],o=r.children[0],d=e.indexOf(Number(o.querySelector("button").innerHTML))>=0;r.classList.toggle("selected",d)}},getSelectedIndex:function(){return this.selectedIndices},getSelectedAddresses:function(){return this.selectedIndices.map(function(e){return this.allTiles[e].address},this)},setSelectedAddresses:function(e,t){var i=this.sanitizeAddresses(e);this.setSelectedIndices(i,t)},setSelectedIndices:function(e,t){e&&0!==e.length||(e=[0]),this.setSelection(e),this.decideSelectedFields(),this._trigger("selectedWells",null,{selectedAddress:this.getSelectedAddresses()}),this.selectObjectInBottomTab(),t||this.addToUndoRedo()}});plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.preset=function(){return{presets:[],_placePresetTabs:function(){var t=this,i=this.options.attributes.presets;if(i&&i.length){this.wellAttrContainer=this._createElement("<div></div>").addClass("plate-setup-well-attr-container").text("Checkbox presets"),this.tabContainer.append(this.wellAttrContainer),this.presetTabContainer=this._createElement("<div></div>").addClass("plate-setup-preset-container"),this.tabContainer.append(this.presetTabContainer);for(var a=function(a){var n=i[a],l=t._createElement("<div></div>").addClass("plate-setup-preset-tab-div").text(n.title),s=t._createElement("<div></div>").addClass("plate-setup-preset-tab").data("preset",n.fields).append(l);t.presetTabContainer.append(s);var r=t;s.click(function(){var t=e(this);r._selectPreset(t)}),t.presets.push(s)},n=0;n<i.length;n++)a(n)}},_clearPresetSelection:function(){for(var e=0;e<this.presets.length;e++){this.presets[e].removeClass("plate-setup-preset-tab-selected").addClass("plate-setup-preset-tab")}},_selectPreset:function(e){this.setCheckboxes(e.data("preset")),e.removeClass("plate-setup-preset-tab").addClass("plate-setup-preset-tab-selected")}}}}(jQuery);plateLayOutWidget=plateLayOutWidget||{};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){plateLayOutWidget.svgCreate=function(){return{baseSizes:{spacing:48,tile_radius:22,center_radius_complete:10,center_radius_incomplete:14,label_size:14,label_spacing:24,text_size:13,stroke:.5,gap:2},allTiles:[],_createSvg:function(){this.svg=new e(this.canvasContainer[0]).addClass();var t=this.baseSizes.label_spacing;this.svg.viewbox(-t,-t,t+this.dimensions.cols*this.baseSizes.spacing,t+this.dimensions.rows*this.baseSizes.spacing),this.wellShadow=this.svg.gradient("radial",function(e){e.at(.8,"rgba(0,0,0,0.1)"),e.at(1,"rgba(0,0,0,0.2)")}).from("50%","50%").to("50%","55%").radius("50%").attr("id","wellShadow"),this.wellColors=this.colorPairs.map(function(e,t){return this.svg.gradient("linear",function(t){t.at(0,e[0]),t.at(1,e[1])}).from(0,0).to(0,1).id("wellColor"+t.toString())},this),this._fixRowAndColumn(),this._putCircles(),this._svgEvents()},_fixRowAndColumn:function(){for(var e=this.dimensions.cols,t=this.dimensions.rows,i=this.svg.nested().attr({x:-this.baseSizes.label_spacing/2}).addClass("rowHead"),a=this.svg.nested().attr({y:-this.baseSizes.label_spacing/2}).addClass("colHead"),n=0;n<t;n++)i.plain(this._rowKey(n)).attr({y:this.baseSizes.spacing*(n+.5)});for(var l=0;l<e;l++)a.plain(this._colKey(l)).attr({x:this.baseSizes.spacing*(l+.5)})},_putCircles:function(){var e=this.dimensions.cols,t=this.dimensions.rows;this.allTiles=Array(e*t);for(var i=0;i<t;i++)for(var a=0;a<e;a++){var n=this._createTile(i,a);this.allTiles[n.index]=n}},_createTile:function(e,t){var i=this.svg.nested().move(this.baseSizes.spacing*t,this.baseSizes.spacing*e).addClass("tile"),a=this.baseSizes.spacing/2,n={tile:i};n.r=e,n.c=t,n.index=this.locToIndex(n),n.address=this.locToAddress(n),i.rect(this.baseSizes.spacing,this.baseSizes.spacing).addClass("highlight"),i.circle(2*this.baseSizes.tile_radius).center(a,a).addClass("well").fill(this.wellShadow);var l=i.group().addClass("fill");return n.circle=l.circle(2*this.baseSizes.tile_radius).center(a,a).addClass("circle").fill(this.wellColors[0]),l.circle(2*this.baseSizes.center_radius_complete).center(a,a).addClass("center"),l.circle(2*this.baseSizes.center_radius_incomplete).center(a,a).addClass("center_incomplete"),n.label=l.plain("0").attr({x:a,y:a}).addClass("label"),n},setTileComplete:function(e,t){t?e.tile.removeClass("incomplete"):e.tile.addClass("incomplete")},setTileVisible:function(e,t){t?e.tile.removeClass("empty"):e.tile.addClass("empty")},setTileColor:function(e,t){this.setTileVisible(e,!0),e.colorIndex=parseInt(t),e.label.plain(String(e.colorIndex)),t>0&&(t=(t-1)%(this.wellColors.length-1)+1),e.circle.fill(this.wellColors[t])}}}}(SVG);plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.svgEvents=function(){return{colorToIndex:{},selectedIndices:[],_svgEvents:function(){var t,i=this;function a(e){var t=i.svg.node.getScreenCTM();return{x:(e.clientX-t.e)/t.a,y:(e.clientY-t.f)/t.d}}function n(e,t){return t-=1,e<0?0:e>=t?t:Math.trunc(e)}function l(e){var t=i.baseSizes.spacing,a=n(e.x/t,i.dimensions.cols);return{r:n(e.y/t,i.dimensions.rows),c:a}}function s(e,t){var a=l(e),n=l(t),s=i.baseSizes.spacing,r=Math.min(a.c,n.c)*s,o=Math.min(a.r,n.r)*s;return e.x<0&&(a.c=i.dimensions.cols-1),e.y<0&&(a.r=i.dimensions.rows-1),{x:r,y:o,width:(Math.max(a.c,n.c)+1)*s-r,height:(Math.max(a.r,n.r)+1)*s-o}}function r(e){t&&(!function(e,t,a){var n=l(e),s=l(t),r=!0;if(a){var o=i.locToIndex(n);r=i.selectedIndices.indexOf(o)<0}var d=Math.min(n.c,s.c),u=Math.min(n.r,s.r);e.x<0&&(n.c=i.dimensions.cols-1),e.y<0&&(n.r=i.dimensions.rows-1);for(var c=Math.max(n.c,s.c),f=Math.max(n.r,s.r),p=[],h=u;h<=f;h++)for(var v=d;v<=c;v++){var b=i.locToIndex({r:h,c:v});p.push(b)}a&&(r?i.selectedIndices.forEach(function(e){p.indexOf(e)<0&&p.push(e)}):p=i.selectedIndices.filter(function(e){return p.indexOf(e)<0})),i.setSelectedIndices(p.sort())}(t.data("origin"),a(e),e.shiftKey),t.remove(),t=null)}this.svg.node.addEventListener("mousedown",function(e){t&&t.remove();var n=a(e),l=s(n,n);(t=i.svg.rect().attr(l).fill("rgba(0, 0, 1, 0.2)")).data("origin",n)}),this.svg.node.addEventListener("mousemove",function(e){if(t){var i=a(e),n=s(t.data("origin"),i);t.attr(n)}}),this.svg.node.addEventListener("mouseleave",r),this.svg.node.addEventListener("mouseup",r),e(i.target).on("loadPlate",function(e,t){i.loadPlate(JSON.parse(t))})},setSelection:function(e){this.selectedIndices=e,this._setSelectedTiles(),document.activeElement.blur()},_setSelectedTiles:function(){var e=this.selectedIndices;this.allTiles.forEach(function(t){e.indexOf(t.index)>=0?t.tile.addClass("selected"):t.tile.removeClass("selected")})},_getSelectedWells:function(){return this.selectedIndices.map(function(e){var t=this.engine.derivative[e];return t||(t=this.defaultWell),t},this)},containsObject:function(e,t){function i(e,t){if(e===t)return!0;if("object"==_typeof(e)&&null!=e&&"object"==_typeof(t)&&null!=t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var a in e)if(e.hasOwnProperty(a)){if(!t.hasOwnProperty(a))return!1;if(!i(e[a],t[a]))return!1}return!0}return!1}if(t)for(var a=0;a<t.length;a++)if(i(e,t[a]))return!0;return!1},_getCommonWell:function(t){if(t.length){for(var i=e.extend(!0,{},t[0]),a=1;a<t.length;a++){var n=t[a];for(var l in i)if(i.hasOwnProperty(l)){var s=i[l];void 0===s&&(s=null);var r=n[l];if(void 0===r&&(r=null),Array.isArray(s)){for(var o=[],d=0;d<s.length;d++){var u=s[d];u&&"object"===_typeof(u)?this.containsObject(u,r)&&o.push(u):e.inArray(u,r)>=0&&o.push(u)}s=o}else r&&"object"===_typeof(r)&&s&&"object"===_typeof(s)?r.value===s.value&&r.unit===s.unit||delete i[l]:s!==r&&delete i[l]}}return i}return this.defaultWell},_getAllMultipleVal:function(e){this.multipleFieldList.forEach(function(t){if(e.length){var i={};e.forEach(function(e){var a=t.id;e[a]&&e[a].length>0&&e[a].forEach(function(e){"object"===_typeof(e)?e[a]in i?i[e[a]]++:i[e[a]]=1:e in i?i[e]++:i[e]=1})}),t.allSelectedMultipleVal=i}else t.allSelectedMultipleVal=null})},decideSelectedFields:function(){var e=this._getSelectedWells();this._getAllMultipleVal(e),this.applyFieldWarning(e);var t=this._getCommonWell(e);this._addDataToTabFields(t)},getWellSetAddressWithData:function(){return Object.keys(this.engine.derivative).map(Number).sort().map(this.indexToAddress,this)}}}}(jQuery);plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.tabs=function(){return{allTabs:[],defaultWell:{},allDataTabs:[],_createTabAtRight:function(){this.tabContainer=this._createElement("<div></div>").addClass("plate-setup-tab-container"),e(this.topRight).append(this.tabContainer)},_createTabs:function(){this.tabHead=this._createElement("<div></div>").addClass("plate-setup-tab-head"),e(this.tabContainer).append(this.tabHead);var t=this.options.attributes.tabs,i=this;t.forEach(function(t,a){i.allTabs[a]=i._createElement("<div></div>").addClass("plate-setup-tab"),e(i.allTabs[a]).data("index",a).text(t.name),e(i.allTabs[a]).click(function(){i._tabClickHandler(this)}),e(i.tabHead).append(i.allTabs[a])}),this.tabDataContainer=this._createElement("<div></div>").addClass("plate-setup-tab-data-container"),e(this.tabContainer).append(this.tabDataContainer),this._addDataTabs(t),e(this.allTabs[0]).click(),this._addTabData()},_tabClickHandler:function(t){if(this.selectedTab){e(this.selectedTab).removeClass("plate-setup-tab-selected").addClass("plate-setup-tab");var i=e(this.selectedTab).data("index");e(this.allDataTabs[i]).css("z-index",0),this.readOnlyHandler()}e(t).addClass("plate-setup-tab-selected"),this.selectedTab=t;var a=e(t).data("index");e(this.allDataTabs[a]).css("z-index",1e3)},_addDataTabs:function(t){this.allDataTabs=t.map(function(){return this._createElement("<div></div>").addClass("plate-setup-data-div").css("z-index",0)},this),e(this.tabContainer).append(this.allDataTabs)}}}}(jQuery);plateLayOutWidget=plateLayOutWidget||{};!function(e){plateLayOutWidget.undoRedoManager=function(){return{undoRedoArray:[],actionPointer:null,addToUndoRedo:function(){var e=this.createState();if(null!=this.actionPointer){var t=this.actionPointer+1;t<this.undoRedoArray.length&&this.undoRedoArray.splice(t,this.undoRedoArray.length-t)}this.actionPointer=null,this.undoRedoArray.push(e)},_configureUndoRedoArray:function(){this.undoRedoArray=[],this.actionPointer=null,this.undoRedoArray.push(e.extend({},{checkboxes:[],derivative:{},selectedIndices:[0]}))},clearHistory:function(){this.undoRedoArray=this.undoRedoArray.slice(-1),this.actionPointer=null},undo:function(){return console.log("undo"),this.shiftUndoRedo(-1)},redo:function(){return console.log("redo"),this.shiftUndoRedo(1)},shiftUndoRedo:function(e){var t=this.actionPointer;return null==t&&(t=this.undoRedoArray.length-1),t+=e,this.setUndoRedo(t)},setUndoRedo:function(e){return!(e<0)&&(!(e>=this.undoRedoArray.length)&&(this.actionPointer=e,this.setData(this.undoRedoArray[e],!0),!0))}}}}(jQuery);
//# sourceMappingURL=plate-map.min.js.map
